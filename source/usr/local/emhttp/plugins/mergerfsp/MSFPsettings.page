Menu="OtherSettings"
Type="xmenu"
Title="mergerFS Settings"
Icon="hdd-o"
Tag="hdd-o"
Markdown="false"
---

<span style="float:right;margin-right:10px"><a href="https://forums.unraid.net/topic/144999-plugin-mergerfs-for-unraid-support-topic/" target="_blank" title="mergerFS Support Thread"><i class="fa fa-medkit"></i> <u>Support Thread</u></a></span>
<div style="color:red;"><strong>WARNING:</strong></div>
<div><strong>mergerFS is a non-supported filesystem for advanced users and can - depending on how YOU set it up - wreak havoc on your system.</strong></div>
<div><strong>Please make yourself familiar with the documentation before trying any unfamiliar mergerFS commands - you are warned only once here.</strong></div>
<div>By default this addon only installs the mergerFS binaries, the rest is up to you to set up via shell scripting (see below for a basic script editor).</div>

<br>

<form markdown="0" id="dwsnap-settings" name="dwsnap_settings" method="POST" action="/update.php" target="progressFrame">
    <input type="hidden" name="#file" value="mergerfsp/mergerfsp.cfg">

    <dl>
        <dt>mergerFS backend:</dt>
        <dd>
            <strong><?= isset($mergerfs_backend) && $mergerfs_backend ? $mergerfs_backend : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt>mergerFS available binaries:</dt>
        <dd>
            <pre>
            /usr/bin/mergerfs
            /usr/bin/mergerfs-fusermount
            </pre>
        </dd>
    </dl>

    <dl>
        <dt>mergerFS-Tools backend:</dt>
        <dd>
            <strong><?= isset($mergerfst_backend) && $mergerfst_backend ? $mergerfst_backend : "n/a" ?></strong>
        </dd>
    </dl>

    <dl>
        <dt>mergerFS-Tools available binaries:</dt>
        <dd>
            <pre>
            /usr/bin/mergerfs.balance
            /usr/bin/mergerfs.consolidate
            /usr/bin/mergerfs.ctl
            /usr/bin/mergerfs.dedup
            /usr/bin/mergerfs.dup
            /usr/bin/mergerfs.fsck
            /usr/bin/mergerfs.mktrash
            </pre>
        </dd>
    </dl>

    <dl>
        <dt>mergerFS Scripting - Array Start Timeout:</dt>
        <dd>
            <input id="TIMERSTART" type="text" class="narrow" name="TIMERSTART" maxlength="30" value="<?=$mergerfsp_timer_start?>">seconds
        </dd>
    </dl>

    <blockquote class="inline_help">
    <p>The maximum execution time for the <em>array_start.sh</em> and <em>array_start_complete.sh</em> scripts before they are hard-killed with SIGKILL.</p>
    <p>This timeout prevents the array start routine to dead-lock in case of a failing, stuck mergerFS command or due to a user programming mistake in the script.</p>
    </blockquote>

    <dl>
        <dt>mergerFS Scripting - Array Stop Timeout:</dt>
        <dd>
            <input id="TIMERSTOP" type="text" class="narrow" name="TIMERSTOP" maxlength="30" value="<?=$mergerfsp_timer_stop?>">seconds
        </dd>
    </dl>

    <blockquote class="inline_help">
    <p>The maximum execution time for the <em>array_stop.sh</em> and <em>array_stop_complete.sh</em> scripts before they are hard-killed with SIGKILL.</p>
    <p>This timeout prevents the array stop routine to dead-lock in case of a failing, stuck mergerFS command or due to a user programming mistake in the script.</p>
    </blockquote>

    <dl>
        <dt>
            <input id="DEFAULT" type="submit" name="#default" value="Default">
        </dt>
        <dd>
            <input type="submit" id="btnApply" name="#apply" value="Apply">
            <input type="button" value="Done" onclick="done()">
        </dd>
    </dl>

</form>

<div style="color:darkorange;"><strong>INFORMATION:</strong></div>
<div><strong>Python 3.x is a requirement <u>for mergerFS-Tools</u> and needs to be installed, if not already present on your system (e.g. via NerdTools)</strong></div>

<script>
$(function() {
    // dynamix plugin update api
    <?if (function_exists('plugin_update_available') && $version = plugin_update_available('mergerfsp')):?>
        showNotice('mergerFS <?=htmlspecialchars($version);?> available. <a>Update</a>','mergerfsp');
        $('#user-notice a').on('click', function () {
        $('#user-notice').empty();
    });
    <?endif;?>
});
</script>
